<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner Dashboard | RoomOnRent</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                }
            }
        }
    </script>
</head>

<body class="bg-[#F8FAFC] font-sans min-h-screen pb-20 overflow-x-hidden selection:bg-indigo-100">

    <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-indigo-200/20 rounded-full mix-blend-multiply filter blur-[100px] animate-pulse"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-blue-200/20 rounded-full mix-blend-multiply filter blur-[100px] animate-pulse"></div>
    </div>

    <div class="bg-slate-900 text-white py-12 px-[5%] mb-10 relative rounded-b-[3rem] shadow-2xl">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="text-center md:text-left">
                <a href="{{ url_for('index') }}" class="inline-flex items-center gap-2 bg-white/10 hover:bg-white/20 px-5 py-2 rounded-2xl text-sm font-bold transition mb-4 no-underline text-white border border-white/10 backdrop-blur-md">
                    <i class="fas fa-arrow-left"></i> Back to Home
                </a>
                <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight">Owner <span class="text-indigo-400">Hub</span></h1>
                <p class="text-slate-400 mt-2 font-medium">Manage your properties and viewing requests</p>
            </div>
            
            <div class="flex gap-4">
                <div class="bg-white/5 border border-white/10 backdrop-blur-md p-6 rounded-[2rem] flex flex-col items-center min-w-[140px]">
                    <span class="text-[10px] font-black uppercase tracking-widest text-indigo-400">Properties</span>
                    <span class="text-3xl font-black mt-1">{{ rooms|length }}</span>
                </div>
                <div class="bg-indigo-600 p-6 rounded-[2rem] shadow-xl shadow-indigo-500/20 flex flex-col items-center min-w-[140px]">
                    <span class="text-[10px] font-black uppercase tracking-widest text-indigo-200">Total Leads</span>
                    <span class="text-3xl font-black mt-1">{{ bookings|length }}</span>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-[5%]">

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="mb-8 p-5 rounded-3xl flex items-center justify-between border {{ 'bg-emerald-50 border-emerald-100 text-emerald-700' if category == 'success' else 'bg-rose-50 border-rose-100 text-rose-700' }} shadow-sm">
                        <span class="font-bold flex items-center gap-3 italic">
                            <i class="fas {{ 'fa-check-circle' if category == 'success' else 'fa-exclamation-circle' }}"></i>
                            {{ message }}
                        </span>
                        <button onclick="this.parentElement.remove()" class="text-xl">&times;</button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="grid grid-cols-1 xl:grid-cols-3 gap-12">
            
            <div class="xl:col-span-2 space-y-12">
                
                <section class="bg-white rounded-[2.5rem] border border-slate-200 overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                    <div class="p-8 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                        <h2 class="text-xl font-black text-slate-800 flex items-center gap-3">
                            <i class="fas fa-envelope-open-text text-indigo-600"></i> New Inquiries
                            {% if new_booking_count and new_booking_count > 0 %}
                                <span class="bg-rose-500 text-white text-[10px] px-2 py-1 rounded-lg animate-pulse">{{ new_booking_count }} NEW</span>
                            {% endif %}
                        </h2>
                    </div>
                    
                    <div class="overflow-x-auto">
                        {% if bookings %}
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 text-slate-400 text-[10px] font-black uppercase tracking-widest border-b border-slate-100">
                                <tr>
                                    <th class="px-8 py-5">Property & Date</th>
                                    <th class="px-6 py-5">Client Details</th>
                                    <th class="px-6 py-5">Status</th>
                                    <th class="px-8 py-5 text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100">
                                {% for booking in bookings %}
                                <tr class="hover:bg-slate-50/80 transition-colors {{ 'bg-indigo-50/30' if booking['status'] == 'New' }}">
                                    <td class="px-8 py-6">
                                        <div class="font-bold text-slate-800 text-sm">{{ booking['room_title'] }}</div>
                                        <div class="text-[10px] text-slate-400 font-bold mt-1 uppercase">{{ booking['timestamp'].split(' ')[0] }}</div>
                                    </td>
                                    <td class="px-6 py-6">
                                        <div class="text-sm font-black text-slate-700">{{ booking['full_name'] }}</div>
                                        <div class="text-xs text-indigo-500 font-bold mt-1"><i class="fas fa-phone-alt mr-1"></i> {{ booking['contact_phone'] }}</div>
                                    </td>
                                    <td class="px-6 py-6">
                                        {% if booking['status'] == 'New' %}
                                            <span class="inline-flex items-center gap-1.5 py-1 px-3 rounded-full bg-amber-100 text-amber-700 text-[10px] font-black uppercase">Pending</span>
                                        {% else %}
                                            <span class="inline-flex items-center gap-1.5 py-1 px-3 rounded-full bg-emerald-100 text-emerald-700 text-[10px] font-black uppercase">Contacted</span>
                                        {% endif %}
                                    </td>
                                    <td class="px-8 py-6 text-right">
                                        {% if booking['status'] == 'New' %}
                                            <form action="{{ url_for('mark_contacted', booking_id=booking['id']) }}" method="post">
                                                <button type="submit" class="bg-slate-900 text-white px-5 py-2 rounded-xl text-xs font-bold hover:bg-indigo-600 transition shadow-lg">Mark Done</button>
                                            </form>
                                        {% else %}
                                            <i class="fas fa-check-double text-emerald-500"></i>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                            <div class="py-20 text-center text-slate-400 italic">No viewing requests yet.</div>
                        {% endif %}
                    </div>
                </section>

                <section class="bg-white rounded-[2.5rem] border border-slate-200 shadow-sm overflow-hidden">
                    <div class="p-8 border-b border-slate-100 bg-slate-50/50">
                        <h2 class="text-xl font-black text-slate-800 flex items-center gap-3">
                            <i class="fas fa-house-user text-indigo-600"></i> My Active Listings
                        </h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 p-8">
                        {% for room in rooms %}
                        <div class="group border border-slate-100 rounded-[2rem] p-5 hover:border-indigo-100 transition-all duration-300 hover:shadow-xl relative overflow-hidden bg-white">
                            <div class="relative h-48 rounded-2xl overflow-hidden mb-5">
                                <img src="{{ url_for('static', filename='uploads/' + (room[5] if room[5] else 'default.jpg')) }}" class="w-full h-full object-cover group-hover:scale-110 transition duration-700">
                                <div class="absolute top-4 right-4 px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest text-white shadow-2xl {{ 'bg-emerald-500' if room[7]=='Available' else 'bg-rose-500' }}">
                                    {{ room[7] }}
                                </div>
                            </div>
                            <h3 class="font-bold text-slate-800 text-lg truncate mb-1">{{ room[1] }}</h3>
                            <p class="text-slate-400 text-xs font-medium mb-4"><i class="fas fa-location-dot mr-1"></i> {{ room[4][:40] }}...</p>
                            
                            <div class="flex justify-between items-center pt-4 border-t border-slate-50">
                                <span class="text-2xl font-black text-indigo-600">₹{{ room[3] }}</span>
                                <form action="{{ url_for('toggle_availability', room_id=room[0]) }}" method="POST">
                                    <button type="submit" class="text-[10px] font-black uppercase tracking-widest px-5 py-2.5 rounded-xl transition-all shadow-sm {{ 'bg-rose-50 text-rose-600 hover:bg-rose-600 hover:text-white' if room[7]=='Available' else 'bg-emerald-50 text-emerald-600 hover:bg-emerald-600 hover:text-white' }}">
                                        {{ 'Deactivate' if room[7] == 'Available' else 'Activate' }}
                                    </button>
                                </form>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </section>
            </div>

            <div class="space-y-8">
                <section class="bg-slate-900 rounded-[3rem] p-10 text-white shadow-2xl sticky top-10 overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-indigo-500/10 rounded-full blur-3xl"></div>
                    
                    <div class="relative z-10">
                        <div class="w-16 h-16 bg-indigo-600 rounded-[1.5rem] flex items-center justify-center mb-8 shadow-xl shadow-indigo-500/20">
                            <i class="fas fa-plus text-2xl"></i>
                        </div>
                        <h2 class="text-3xl font-black mb-3">List New Space</h2>
                        <p class="text-slate-400 text-sm mb-10 leading-relaxed">Fill in the details to publish your room on our premium network.</p>
                        
                        <form action="{{ url_for('add_room') }}" method="POST" enctype="multipart/form-data" class="space-y-6">
                            <div class="space-y-2">
                                <label class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-500 ml-1">Property Title</label>
                                <input type="text" name="title" required class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-sm focus:ring-2 focus:ring-indigo-500 focus:bg-white focus:text-slate-900 outline-none transition-all" placeholder="Modern Studio">
                            </div>
                            
                            <div class="space-y-2">
                                <label class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-500 ml-1">Rent Amount (₹)</label>
                                <input type="number" name="rent" required class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-sm focus:ring-2 focus:ring-indigo-500 focus:bg-white focus:text-slate-900 outline-none transition-all" placeholder="5000">
                            </div>

                            <div class="space-y-2">
                                <label class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-500 ml-1">Location / Landmark</label>
                                <input type="text" name="address" required class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-sm focus:ring-2 focus:ring-indigo-500 focus:bg-white focus:text-slate-900 outline-none transition-all" placeholder="Sector 4, Pune">
                            </div>

                            <div class="space-y-2">
                                <label class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-500 ml-1">Gallery</label>
                                <label class="group flex flex-col items-center justify-center w-full h-32 bg-white/5 border-2 border-dashed border-white/10 rounded-3xl cursor-pointer hover:bg-white/10 hover:border-indigo-500 transition-all">
                                    <div class="flex flex-col items-center justify-center text-slate-400 group-hover:text-indigo-400">
                                        <i class="fas fa-camera-retro text-2xl mb-2"></i>
                                        <p class="text-[10px] font-bold uppercase tracking-widest" id="file-count">Add Photos</p>
                                    </div>
                                    <input type="file" name="room_images[]" id="images" multiple required class="hidden" accept="image/*">
                                </label>
                            </div>

                            <div class="space-y-2">
                                <label class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-500 ml-1">Room Description</label>
                                <textarea name="description" required rows="4" class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-sm focus:ring-2 focus:ring-indigo-500 focus:bg-white focus:text-slate-900 outline-none transition-all resize-none" placeholder="Key highlights..."></textarea>
                            </div>

                            <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-5 rounded-[2rem] font-black shadow-2xl shadow-indigo-500/30 transition-all transform active:scale-95 flex items-center justify-center gap-3 group">
                                <i class="fas fa-paper-plane group-hover:translate-x-1 group-hover:-translate-y-1 transition-transform"></i> 
                                Publish Now
                            </button>
                        </form>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <p class="text-center mt-20 text-slate-400 text-[10px] font-black uppercase tracking-[0.4em]">
        Platform Engine &copy; 2026 RoomOnRent | Dashboard v2.4
    </p>

    <script>
        // Update file count logic
        const fileInput = document.getElementById('images');
        const fileCountText = document.getElementById('file-count');

        fileInput.addEventListener('change', () => {
            const count = fileInput.files.length;
            fileCountText.innerText = count > 0 ? `${count} Files Ready` : 'Add Photos';
            if(count > 0) fileCountText.classList.replace('text-slate-400', 'text-indigo-400');
        });

        // Simple smooth scroll logic for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>